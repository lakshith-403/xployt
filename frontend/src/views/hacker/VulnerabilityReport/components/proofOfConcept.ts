import { Quark, QuarkFunction as $ } from '@ui_lib/quark';
import { StepComponent } from './stepComponent';
import {ButtonType} from "@components/button/base";
import {IconButton} from "@components/button/icon.button";
import {formObject} from "@views/hacker/VulnerabilityReport/VulnerabilityReportForm";

export class ProofOfConceptSection {
    private formObject: formObject;
    private files: File[];
    private stepCount: number;

    constructor(formObject: formObject, files: File[], initialStepCount: number = 2) {
        this.formObject = formObject;
        this.files = files;
        this.stepCount = initialStepCount;
    }

    private addStep(container: Quark): void {
        this.stepCount++;
        this.renderStep(container, this.stepCount);
    }

    private renderStep(container: Quark, i: number): void {
        this.formObject.steps.push({
            description: '',
            attachments: ''
        });
        new StepComponent(this.formObject, this.files, i).render(container);
    }

    render(q: Quark): void {
        $(q, 'div', 'form-section section-divider', {id: 'proofOfConcept'}, (q) => {
            $(q, 'h2', 'section-subtitle', {}, (q) => {
                q.innerHTML = 'Proof of Concept';
            });
            const stepsContainer = $(q, 'div', 'step-container', {}, (q) => {

                for (let i = 1; i <= this.stepCount; i++) {
                    this.renderStep(q, i);
                }
            });

            new IconButton({
                icon: 'fa fa-plus',
                label: 'Add Step',
                type: ButtonType.SECONDARY,
                onClick: (event: Event) => {
                    event.preventDefault()
                    this.addStep(stepsContainer)
                }
            }).render(q)
        })
    }
}
